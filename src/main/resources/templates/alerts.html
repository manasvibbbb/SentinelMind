<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Alerts â€“ SentinelMind</title>
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>

<!-- NAVBAR -->
<div th:replace="fragments/navbar :: body"></div>

<div class="container">

    <!-- HEADER -->
    <div class="card header-card">
        <h1>ðŸš¨ Alert Intelligence Center</h1>
        <p class="subtitle">
            Real-time detection of operational anomalies with
            explainable AI-driven risk assessment.
        </p>
        <p class="description">
            Alerts are generated when live workflow metrics deviate
            significantly from learned departmental baselines.
        </p>
    </div>

    <!-- METRICS -->
    <div class="grid-2">
        <div class="card metric">
            <h3>Total Alerts</h3>
            <span class="metric-value" th:text="${alerts.size()}">0</span>
        </div>

        <div class="card metric critical">
            <h3>High Risk</h3>
            <span class="metric-value"
                  th:text="${alerts.?[riskLevel=='HIGH'].size()}">0</span>
        </div>
    </div>

    <!-- FILTER BAR -->
    <div class="card filters">
        <div class="filter-group">
            <label>Risk Level</label>
            <select id="riskFilter" onchange="filterTable()">
                <option value="">All</option>
                <option value="HIGH">HIGH</option>
                <option value="MEDIUM">MEDIUM</option>
                <option value="LOW">LOW</option>
            </select>
        </div>

        <div class="filter-group">
            <label>Department</label>
            <select id="deptFilter" onchange="filterTable()">
                <option value="">All</option>
                <option value="ER">ER</option>
                <option value="ICU">ICU</option>
                <option value="OPD">OPD</option>
            </select>
        </div>
    </div>

    <!-- ALERT TABLE -->
    <div class="card table-card">
        <table id="alertsTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>Department</th>
                <th>Risk</th>
                <th>Explanation</th>
                <th>Detected At</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="alert : ${alerts}"
                th:classappend="${alert.riskLevel == 'HIGH'} ? 'row-critical'">

                <td th:text="${alert.id}"></td>

                <td>
                    <a th:href="@{'/department/' + ${alert.department.name}}"
                       class="link"
                       th:text="${alert.department.name}">
                    </a>
                </td>

                <td>
                    <span class="risk-badge"
                          th:text="${alert.riskLevel}"
                          th:classappend="' ' + ${alert.riskLevel}">
                        HIGH
                    </span>
                </td>

                <td th:text="${alert.message}"></td>

                <td th:text="${alert.createdAt}"></td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

<script>
    function filterTable() {
        const risk = document.getElementById("riskFilter").value;
        const dept = document.getElementById("deptFilter").value;
        const rows = document.querySelectorAll("#alertsTable tbody tr");

        rows.forEach(row => {
            const r = row.querySelector(".risk-badge").innerText;
            const d = row.cells[1].innerText;
            row.style.display =
                (risk === "" || r === risk) &&
                (dept === "" || d === dept)
                    ? "" : "none";
        });
    }
</script>

</body>
</html>
