<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>AI Charts â€“ SentinelMind</title>

    <link rel="stylesheet" href="/css/main.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- NAVBAR -->
<div th:replace="fragments/navbar :: body"></div>

<div class="container">

    <!-- HEADER -->
    <div class="card header-card">
        <h1>ðŸ“Š AI Trend Charts â€“ <span th:text="${department}">ER</span></h1>
        <p class="description">
            Visualized operational metrics tracked over time to support
            explainable, data-driven hospital decisions.
        </p>
    </div>

    <!-- DEPARTMENT SELECT -->
    <div class="card">
        <form method="get" action="/charts">
            <label><strong>Select Department:</strong></label>
            <select name="department" onchange="this.form.submit()">
                <option value="ER" th:selected="${department == 'ER'}">ER</option>
                <option value="ICU" th:selected="${department == 'ICU'}">ICU</option>
                <option value="OPD" th:selected="${department == 'OPD'}">OPD</option>
            </select>
        </form>
    </div>

    <!-- CHARTS -->
    <div class="card chart-box">
        <canvas id="patientsChart"></canvas>
    </div>

    <div class="card chart-box">
        <canvas id="responseChart"></canvas>
    </div>

    <div class="card chart-box">
        <canvas id="staffChart"></canvas>
    </div>

</div>

<!-- DATA + CHART LOGIC -->
<script th:inline="javascript">
    /* Thymeleaf injects Java List as JS array */
    const records = [[${records}]];

    const labels = records.map(r => r.timestamp);
    const patients = records.map(r => r.patientCount);
    const response = records.map(r => r.avgResponseTime);
    const staff = records.map(r => r.staffOnDuty);

    new Chart(document.getElementById("patientsChart"), {
        type: "line",
        data: {
            labels,
            datasets: [{
                label: "Patient Count",
                data: patients,
                borderColor: "#1F8A70",
                tension: 0.3,
                fill: false
            }]
        }
    });

    new Chart(document.getElementById("responseChart"), {
        type: "line",
        data: {
            labels,
            datasets: [{
                label: "Avg Response Time (min)",
                data: response,
                borderColor: "#C0392B",
                tension: 0.3,
                fill: false
            }]
        }
    });

    new Chart(document.getElementById("staffChart"), {
        type: "line",
        data: {
            labels,
            datasets: [{
                label: "Staff On Duty",
                data: staff,
                borderColor: "#0F4C81",
                tension: 0.3,
                fill: false
            }]
        }
    });
</script>

</body>
</html>
